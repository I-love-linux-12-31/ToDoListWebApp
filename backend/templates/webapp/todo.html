{% extends 'base.html' %}

{% block content %}
<div class="container mt-5">
    <h2>To-Do List</h2>

    {% macro render_task(task, level=1) %}
        {% set is_readonly = not task["writable"] %}
        {% set is_today_deadline = (task["deadline"] and task["deadline"].date() == current_date.date()) %}

        <li class="{% if is_today_deadline %}bg-warning{% endif %}" style="padding: 5px 0 5px 5px;margin-bottom: 5px; border-radius: 5px;">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <span {% if is_readonly %}class="text-muted"{% endif %}>
                        {{ task["title"] }}
                        {% if is_readonly %}
                            <span title="Read Only">ğŸ”’</span>
                        {% endif %}
                    </span>
                </div>

                <div>
                    {% if not is_readonly %}
                        <a href="{{ url_for('webapp.todo.add_task', parent_id=task['id']) }}" class="btn btn-sm btn-success">Add</a>
                        <a href="{{ url_for('webapp.todo.delete_task', task_id=task['id']) }}" class="btn btn-sm btn-danger">Delete</a>
                    {% endif %}
                    {% if task["writable"] %}
                        <a href="{{ url_for('webapp.todo.share_task', task_id=task['id']) }}" class="btn btn-sm btn-info">Share</a>
                    {% endif %}
                </div>
            </div>

            {% if task.get("children") %}
                <ul style="margin-top: 8px;">
                    {% for child in task["children"] %}
                        {{ render_task(child, level + 1) }}
                    {% endfor %}
                </ul>
            {% endif %}
        </li>
    {% endmacro %}

    <ul>
        {% for task in tasks %}
            {{ render_task(task) }}
        {% endfor %}
    </ul>

</div>
{% endblock %}
